# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –≤–∏–¥–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- **Python 3.11+** - –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **uv** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º
- **aiogram 3.x** - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram Bot API (polling)
- **openai** - –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LLM –∏ Speech-to-Text —á–µ—Ä–µ–∑ OpenRouter/Ollama (–µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- **pydantic** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ structured output –¥–ª—è LLM
- **python-dotenv** - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **Make** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- **Faster Whisper** - –ª–æ–∫–∞–ª—å–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ GPU (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, –≤ 4-6x –±—ã—Å—Ç—Ä–µ–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ Whisper)

## –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
- **KISS** (Keep It Simple, Stupid) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ—à–µ–Ω–∏–π
- **YAGNI** (You Aren't Gonna Need It) - —Ä–µ–∞–ª–∏–∑—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–µ–π—á–∞—Å
- **–ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –≤–µ—Å—å –∫–æ–¥ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, –Ω–∏–∫–∞–∫–∏—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
- **–ü—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω—ã–π –∫–æ–¥** - –º–∏–Ω–∏–º—É–º –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π, –º–∞–∫—Å–∏–º—É–º —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
- **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç** - –æ—Ç –∏–¥–µ–∏ –¥–æ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞ –∑–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è

**–ß—Ç–æ –ù–ï –¥–µ–ª–∞–µ–º:**
- –ù–µ —Å–æ–∑–¥–∞–µ–º —Å–ª–æ–∂–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- –ù–µ –¥–µ–ª–∞–µ–º –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
- –ù–µ –¥–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ "–Ω–∞ –±—É–¥—É—â–µ–µ"
- –ù–µ —É—Å–ª–æ–∂–Ω—è–µ–º –±–µ–∑ –∫—Ä–∞–π–Ω–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ bot.py          # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è aiogram
‚îÇ   ‚îú‚îÄ‚îÄ handlers.py     # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π Telegram
‚îÇ   ‚îú‚îÄ‚îÄ llm.py          # –†–∞–±–æ—Ç–∞ —Å LLM –∏ Speech-to-Text —á–µ—Ä–µ–∑ OpenRouter/Ollama
‚îÇ   ‚îú‚îÄ‚îÄ models.py       # Pydantic –º–æ–¥–µ–ª–∏ –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ config.py       # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ .env
‚îú‚îÄ‚îÄ prompts/
‚îÇ   ‚îú‚îÄ‚îÄ system_prompt_text.txt   # –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ system_prompt_image.txt  # –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ voice-transcription-research.md  # –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ vision.md       # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –≤–∏–¥–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ idea.md         # –û–ø–∏—Å–∞–Ω–∏–µ –∏–¥–µ–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ .env                # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ç–æ–∫–µ–Ω—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
‚îú‚îÄ‚îÄ .env.example        # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ pyproject.toml      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è uv
‚îú‚îÄ‚îÄ Makefile            # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É
```

**–ü—Ä–∏–Ω—Ü–∏–ø:** –í—Å–µ–≥–æ 5 Python-—Ñ–∞–π–ª–æ–≤ –≤ –æ–¥–Ω–æ–π –ø–∞–ø–∫–µ `src/`. –ù–∏–∫–∞–∫–∏—Ö –ø–∞–∫–µ—Ç–æ–≤, –ø–æ–¥–ø–∞–∫–µ—Ç–æ–≤, —Å–ª–æ–∂–Ω–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–∏.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **bot.py** - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç aiogram Bot –∏ Dispatcher
   - –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç handlers
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç polling

2. **handlers.py** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
   - `/start` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏/—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - `/balance` - –æ—Ç—á–µ—Ç –æ –±–∞–ª–∞–Ω—Å–µ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
   - `/transactions` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π ‚Üí —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è —á–µ—Ä–µ–∑ Whisper API ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∫ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π ‚Üí –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ LLM ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ‚Üí –ø–æ–∫–∞–∑ –æ—Ç–≤–µ—Ç–∞ + —Å—Ç–∞—Ç—É—Å + –±–∞–ª–∞–Ω—Å
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚Üí –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ VLM ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ‚Üí –ø–æ–∫–∞–∑ –æ—Ç–≤–µ—Ç–∞ + —Å—Ç–∞—Ç—É—Å + –±–∞–ª–∞–Ω—Å
   - –•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–æ–≤ –≤ –ø–∞–º—è—Ç–∏: `dict[int, list]` (chat_id ‚Üí —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π)
   - –•—Ä–∞–Ω–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ø–∞–º—è—Ç–∏: `dict[int, list[Transaction]]` (chat_id ‚Üí —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)

3. **llm.py** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM
   - –ú–µ—Ç–æ–¥ `transcribe_voice()` - —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Whisper API
   - –ú–µ—Ç–æ–¥ `get_transaction_response_text()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å–æ structured output
   - –ú–µ—Ç–æ–¥ `get_transaction_response_image()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (VLM) —Å–æ structured output
   - –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–µ—Ä–µ–∑ AsyncOpenAI –¥–ª—è OpenRouter –∏ Ollama
   - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–Ω–µ—à–Ω–∏–º–∏ –∏ –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

4. **models.py** - –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
   - Pydantic –º–æ–¥–µ–ª–∏ –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (Transaction, TransactionResponse)
   - Enums –¥–ª—è —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (TransactionType, TransactionFrequency)
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

5. **config.py** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
   - –ö–ª–∞—Å—Å Config —Å –ø–æ–ª—è–º–∏: `TELEGRAM_TOKEN`, `OPENAI_API_KEY`, `OPENAI_BASE_URL`, `MODEL_TEXT`, `MODEL_IMAGE`, `SYSTEM_PROMPT_TEXT`, `SYSTEM_PROMPT_IMAGE`
   - –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏–∑ —Ñ–∞–π–ª–æ–≤ (`prompts/system_prompt_text.txt`, `prompts/system_prompt_image.txt`) –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º –ø—Ä–æ–º–ø—Ç–æ–≤ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —á–µ—Ä–µ–∑ `SYSTEM_PROMPT_TEXT_PATH` –∏ `SYSTEM_PROMPT_IMAGE_PATH` –≤ .env
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ .env —á–µ—Ä–µ–∑ python-dotenv
   - `MODEL_TEXT` - –º–æ–¥–µ–ª—å –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, `MODEL_IMAGE` - –º–æ–¥–µ–ª—å –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (vision)

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (—Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è):**
```
Telegram ‚Üí handlers.py (–ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ) ‚Üí llm.py (structured output) ‚Üí OpenRouter/Ollama ‚Üí 
llm.py ‚Üí handlers.py (–∏–∑–≤–ª–µ—á—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ transactions, –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç + —Å—Ç–∞—Ç—É—Å + –±–∞–ª–∞–Ω—Å) ‚Üí Telegram
```

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è):**
```
Telegram ‚Üí handlers.py (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí base64) ‚Üí llm.py (VLM + structured output) ‚Üí OpenRouter/Ollama ‚Üí 
llm.py ‚Üí handlers.py (–∏–∑–≤–ª–µ—á—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ transactions, –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç + —Å—Ç–∞—Ç—É—Å + –±–∞–ª–∞–Ω—Å) ‚Üí Telegram
```

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (–≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è):**
```
Telegram ‚Üí handlers.py (–≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí bytes) ‚Üí llm.py (Whisper API) ‚Üí —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç ‚Üí 
handlers.py (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∫ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ) ‚Üí llm.py (structured output) ‚Üí OpenRouter/Ollama ‚Üí 
llm.py ‚Üí handlers.py (–∏–∑–≤–ª–µ—á—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ transactions, –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç + —Å—Ç–∞—Ç—É—Å + –±–∞–ª–∞–Ω—Å) ‚Üí Telegram
```

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ù–∏–∫–∞–∫–æ–π DI, –Ω–∏–∫–∞–∫–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –Ω–∏–∫–∞–∫–∏—Ö —Å–ª–æ–µ–≤ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏. –ü—Ä–æ—Å—Ç–æ –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–π.

## –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

**–•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ (–±–µ–∑ –ë–î):**

–ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞—Ä–∏ –≤ `handlers.py`:
```python
chat_conversations: dict[int, list[dict]] = {}  # –∏—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ (–¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
transactions: dict[int, list[Transaction]] = {}  # —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞:**
```python
chat_conversations[chat_id] = [
    {"role": "system", "content": "—Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç"},
    {"role": "user", "content": "—Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"},
    {"role": "assistant", "content": "–æ—Ç–≤–µ—Ç LLM"},
    ...
]
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:**
```python
from models import Transaction, TransactionType, TransactionFrequency

transactions[chat_id] = [
    Transaction(
        date=date(2024, 1, 15),
        time=time(14, 30),
        type=TransactionType.EXPENSE,
        amount=1500.0,
        frequency=TransactionFrequency.DAILY,
        category="–ø—Ä–æ–¥—É–∫—Ç—ã",
        description="–ú–æ–ª–æ–∫–æ, —Ö–ª–µ–±, —è–π—Ü–∞ –≤ –º–∞–≥–∞–∑–∏–Ω–µ –ü—è—Ç—ë—Ä–æ—á–∫–∞"
    ),
    ...
]
```

**Pydantic –º–æ–¥–µ–ª–∏ (src/models.py):**

```python
from pydantic import BaseModel, Field
from datetime import date, time
from enum import Enum

class TransactionType(str, Enum):
    INCOME = "income"      # –¥–æ—Ö–æ–¥
    EXPENSE = "expense"    # —Ä–∞—Å—Ö–æ–¥

class TransactionFrequency(str, Enum):
    DAILY = "daily"           # –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã–µ
    PERIODIC = "periodic"     # –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ
    ONE_TIME = "one_time"     # —Ä–∞–∑–æ–≤—ã–µ

class Transaction(BaseModel):
    date: date                           # –¥–∞—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    time: time | None = None            # –≤—Ä–µ–º—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    type: TransactionType                # –¥–æ—Ö–æ–¥/—Ä–∞—Å—Ö–æ–¥
    amount: float = Field(gt=0)          # —Å—É–º–º–∞ (—Å—Ç—Ä–æ–≥–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è)
    frequency: TransactionFrequency       # —Ç–∏–ø (–ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã–µ, –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ, —Ä–∞–∑–æ–≤—ã–µ)
    category: str                        # –∫–∞—Ç–µ–≥–æ—Ä–∏—è (–ø—Ä–æ–¥—É–∫—Ç—ã, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, —Ç–∞–∫—Å–∏ –∏ —Ç.–¥.)
    description: str = ""                # –æ–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–∞—Ö, —É—Å–ª—É–≥–∞—Ö, –∏—Å—Ç–æ—á–Ω–∏–∫–µ, –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–µ –∏ —Ç.–ø.)

class TransactionResponse(BaseModel):
    transactions: list[Transaction] = []  # —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º)
    answer: str                           # —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω)
```

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤/–¥–æ—Ö–æ–¥–æ–≤:**
- –ë–∞–∑–æ–≤—ã–π —Å–ø–∏—Å–æ–∫: –ø—Ä–æ–¥—É–∫—Ç—ã, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, —Ç–∞–∫—Å–∏, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è, –∑–¥–æ—Ä–æ–≤—å–µ, –æ–¥–µ–∂–¥–∞, –¥—Ä—É–≥–∏–µ
- LLM –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Å–ø–∏—Å–æ–∫
- –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è "–¥—Ä—É–≥–∏–µ"

**–û–ø–µ—Ä–∞—Ü–∏–∏:**
- –ü—Ä–∏ `/start` - –æ—á–∏—â–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —á–∞—Ç–∞
- –ü—Ä–∏ –Ω–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ - –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¢–û–õ–¨–ö–û –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ `transactions[chat_id]`
- –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ - –≤—Å—è –∏—Å—Ç–æ—Ä–∏—è –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–µ—Ä—è—é—Ç—Å—è

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å—Ç–æ—Ç–∞. –ù–∏–∫–∞–∫–∏—Ö –ë–î, —Ñ–∞–π–ª–æ–≤, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∂–∏–≤—É—Ç —Ç–æ–ª—å–∫–æ –≤ runtime.

## –†–∞–±–æ—Ç–∞ —Å LLM

**–ò—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞:** `openai` (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Python client, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```python
from openai import AsyncOpenAI

# –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è OpenRouter –∏ Ollama
# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–µ base_url –∏ model –≤ .env
client = AsyncOpenAI(
    api_key=config.OPENAI_API_KEY,  # –¥–ª—è Ollama –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    base_url=config.OPENAI_BASE_URL  # https://openrouter.ai/api/v1 –∏–ª–∏ http://localhost:11434/v1
)
```

**–ú–µ—Ç–æ–¥—ã –≤ llm.py:**

**1. –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:**
```python
from faster_whisper import WhisperModel
import tempfile
import os
import asyncio

# –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–≤ bot.py –∏–ª–∏ llm.py)
whisper_model = WhisperModel(
    "base",  # –∏–ª–∏ "small", "medium" –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
    device="cuda",  # –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GPU
    compute_type="float16"  # –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è GPU
)

async def transcribe_voice(audio_bytes: bytes) -> str:
    """–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ Faster Whisper –ª–æ–∫–∞–ª—å–Ω–æ.
    
    Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ OGG Opus.
    Faster Whisper –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —ç—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç –Ω–∞–ø—Ä—è–º—É—é.
    """
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
    with tempfile.NamedTemporaryFile(suffix=".ogg", delete=False) as temp_file:
        temp_file.write(audio_bytes)
        temp_path = temp_file.name
    
    try:
        # –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ (whisper —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)
        def transcribe_sync():
            segments, info = whisper_model.transcribe(
                temp_path,
                language="ru",
                beam_size=5  # –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –∫–∞—á–µ—Å—Ç–≤–æ–º –∏ —Å–∫–æ—Ä–æ—Å—Ç—å—é
            )
            return " ".join([segment.text for segment in segments]).strip()
        
        # –ó–∞–ø—É—Å–∫ –≤ executor –¥–ª—è –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–π —Ä–∞–±–æ—Ç—ã
        text = await asyncio.get_event_loop().run_in_executor(None, transcribe_sync)
        return text
    finally:
        # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
        os.unlink(temp_path)
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Telegram –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ **OGG Opus**
- Faster Whisper –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —ç—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç –Ω–∞–ø—Ä—è–º—É—é (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è)
- **–°—Ç–æ–∏–º–æ—Å—Ç—å: 0‚ÇΩ** (–ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–Ω–æ!)
- **–°–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ RTX 4090**: ~1-2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –º–∏–Ω—É—Ç—É –∞—É–¥–∏–æ (–º–æ–¥–µ–ª—å "base")
- –ö–∞—á–µ—Å—Ç–≤–æ: –æ—Ç–ª–∏—á–Ω–æ–µ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ (WER ~3-5%), –∏–¥–µ–Ω—Ç–∏—á–Ω–æ OpenAI Whisper API
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç GPU –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (CUDA)
- –í 4-6 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ Whisper
- –ú–µ–Ω—å—à–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ (–≤ 2-3 —Ä–∞–∑–∞)

**–†–∞–∑–º–µ—Ä—ã –º–æ–¥–µ–ª–µ–π Faster Whisper:**
- `tiny`: ~75MB RAM, —Ç–æ—á–Ω–æ—Å—Ç—å 70-75%, ~0.5 —Å–µ–∫/–º–∏–Ω –Ω–∞ GPU
- `base`: ~150MB RAM, —Ç–æ—á–Ω–æ—Å—Ç—å 75-80%, ~1-2 —Å–µ–∫/–º–∏–Ω –Ω–∞ GPU ‚úÖ **—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è**
- `small`: ~500MB RAM, —Ç–æ—á–Ω–æ—Å—Ç—å 80-85%, ~2-3 —Å–µ–∫/–º–∏–Ω –Ω–∞ GPU
- `medium`: ~1.5GB RAM, —Ç–æ—á–Ω–æ—Å—Ç—å 85-90%, ~3-5 —Å–µ–∫/–º–∏–Ω –Ω–∞ GPU
- `large-v3`: ~3GB RAM, —Ç–æ—á–Ω–æ—Å—Ç—å 90-95%, ~5-10 —Å–µ–∫/–º–∏–Ω –Ω–∞ GPU

–î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤ –º–æ–¥–µ–ª—å **"base"** - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä (—Å–∫–æ—Ä–æ—Å—Ç—å + –∫–∞—á–µ—Å—Ç–≤–æ).

**2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:**
```python
async def get_transaction_response_text(
    last_message: str,
    message_history: list[dict]
) -> TransactionResponse:
    # Structured output —á–µ—Ä–µ–∑ response_format —Å JSON schema –∏–∑ Pydantic
        response = await client.chat.completions.create(
        model=config.MODEL,
        messages=[
            {"role": "system", "content": config.SYSTEM_PROMPT_TEXT},
            *message_history[-10:],  # –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            {"role": "user", "content": last_message}
        ],
        response_format={"type": "json_schema", "json_schema": {
            "name": "transaction_response",
            "schema": TransactionResponse.model_json_schema(),
            "strict": True
        }}
    )
    # –ü–∞—Ä—Å–∏–Ω–≥ JSON –æ—Ç–≤–µ—Ç–∞ –≤ TransactionResponse
    return TransactionResponse.model_validate_json(response.choices[0].message.content)
```

**3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (VLM):**
```python
async def get_transaction_response_image(
    image_base64: str,
    message_history: list[dict]
) -> TransactionResponse:
    # Vision API —Å structured output
        response = await client.chat.completions.create(
        model=config.MODEL,
        messages=[
            {"role": "system", "content": config.SYSTEM_PROMPT_IMAGE},
            *message_history[-10:],
            {
                "role": "user",
                "content": [
                    {"type": "image_url", "image_url": {"url": f"data:image/jpeg;base64,{image_base64}"}},
                    {"type": "text", "text": "–ò–∑–≤–ª–µ–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑ —ç—Ç–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"}
                ]
            }
        ],
        response_format={"type": "json_schema", "json_schema": {
            "name": "transaction_response",
            "schema": TransactionResponse.model_json_schema(),
            "strict": True
        }}
    )
    return TransactionResponse.model_validate_json(response.choices[0].message.content)
```

**–í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- **Speech-to-Text**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OpenAI Whisper API –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—Ñ–æ—Ä–º–∞—Ç OGG Opus –∏–∑ Telegram)
- **Structured output**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Pydantic –º–æ–¥–µ–ª–µ–π –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ LLM —á–µ—Ä–µ–∑ `response_format` —Å JSON schema
- **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**: –¢–û–õ–¨–ö–û –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ –∏–∑ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏) - –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç–æ –≤ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–∞—Ö
- **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π**: –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–µ—Ä–µ–∑ AsyncOpenAI, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–µ `OPENAI_BASE_URL` –∏ `MODEL` –≤ .env —Ñ–∞–π–ª–µ

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ .env:**
- `OPENAI_API_KEY` - –∫–ª—é—á –æ—Ç OpenRouter (–¥–ª—è Ollama –º–æ–∂–Ω–æ –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
- –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –¥–ª—è Faster Whisper API-–∫–ª—é—á –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (—Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ)
- `OPENAI_BASE_URL` - URL API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:
  - –î–ª—è OpenRouter: `https://openrouter.ai/api/v1`
  - –î–ª—è Ollama: `http://localhost:11434/v1`
- `MODEL_TEXT` - –º–æ–¥–µ–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä `openai/gpt-oss-20b:free` –¥–ª—è OpenRouter –∏–ª–∏ `llama3.2` –¥–ª—è Ollama)
- `MODEL_IMAGE` - –º–æ–¥–µ–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –¥–æ–ª–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å vision (–Ω–∞–ø—Ä–∏–º–µ—Ä `meta-llama/llama-3.2-11b-vision-instruct` –¥–ª—è OpenRouter –∏–ª–∏ `llama3.2-vision` –¥–ª—è Ollama)
- `SYSTEM_PROMPT_TEXT_PATH` - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `prompts/system_prompt_text.txt`)
- `SYSTEM_PROMPT_IMAGE_PATH` - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `prompts/system_prompt_image.txt`)
- `SYSTEM_PROMPT_TEXT` - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞–ø—Ä—è–º—É—é (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ —Ñ–∞–π–ª–∞)
- `SYSTEM_PROMPT_IMAGE` - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞–ø—Ä—è–º—É—é (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ —Ñ–∞–π–ª–∞)

**–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏:**
–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è OpenRouter:
```bash
OPENAI_BASE_URL=https://openrouter.ai/api/v1
MODEL_TEXT=openai/gpt-oss-20b:free
MODEL_IMAGE=meta-llama/llama-3.2-11b-vision-instruct
```

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Ollama:
```bash
OPENAI_BASE_URL=http://localhost:11434/v1
MODEL_TEXT=llama3.2
MODEL_IMAGE=llama3.2-vision
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- try/except –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
- –í–æ–∑–≤—Ä–∞—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ Pydantic (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Whisper API, –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã)

**–í—ã–±–æ—Ä —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏:**
- **–ò—Å–ø–æ–ª—å–∑—É–µ–º: Faster Whisper –ª–æ–∫–∞–ª—å–Ω–æ** (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, GPU RTX 4090, –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –±—ã—Å—Ç—Ä–æ)
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: OpenAI Whisper API (–ø–ª–∞—Ç–Ω—ã–π ~$0.006/–º–∏–Ω, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç GPU, –ø—Ä–æ—â–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ)
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Vosk (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ CPU, –º–µ–Ω—å—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ)
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–¥—Ö–æ–¥–æ–≤: —Å–º. `docs/voice-transcription-research.md`

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç —Å structured output. –ù–∏–∫–∞–∫–æ–≥–æ retry, –Ω–∏–∫–∞–∫–∏—Ö –æ—á–µ—Ä–µ–¥–µ–π, –Ω–∏–∫–∞–∫–æ–≥–æ streaming.

## –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã

–ü—Ä–æ–º–ø—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ñ–∞–π–ª–∞—Ö `prompts/system_prompt_text.txt` –∏ `prompts/system_prompt_image.txt` –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —á—Ç–µ–Ω–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `SYSTEM_PROMPT_TEXT_PATH` –∏ `SYSTEM_PROMPT_IMAGE_PATH`.

**–î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π** (`prompts/system_prompt_text.txt`):
```
–¢—ã –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å–æ–≤–µ—Ç–Ω–∏–∫. –ü–æ–º–æ–≥–∞–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–µ—Å—Ç–∏ —É—á–µ—Ç –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤.

–í–ê–ñ–ù–û: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑–≤–ª–µ–∫–∞–π –¢–û–õ–¨–ö–û –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

–ù–û: –î–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å–ø–æ–ª—å–∑—É–π –í–°–Æ –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞! –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –ø—Ä–æ—à–ª—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Å–æ–±—ã—Ç–∏—è –∏–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ - –æ—Ç–≤–µ—á–∞–π –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞:
1. –ò–∑–≤–ª–µ—á—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¢–û–õ–¨–ö–û –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ!)
2. –î–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏ (–∏—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–û —ç—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º):
   - "date" (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD —Å—Ç—Ä–æ–∫–æ–π, –∏—Å–ø–æ–ª—å–∑—É–π —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞)
   - "time" (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ –≤—Ä–µ–º—è, —Ñ–æ—Ä–º–∞—Ç HH:MM:SS —Å—Ç—Ä–æ–∫–æ–π, –∏–Ω–∞—á–µ null)
   - "type" (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Å—Ç—Ä–æ–∫–∞: "income" –¥–ª—è –¥–æ—Ö–æ–¥–∞ –∏–ª–∏ "expense" –¥–ª—è —Ä–∞—Å—Ö–æ–¥–∞)
   - "amount" (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ float, –Ω–∞–ø—Ä–∏–º–µ—Ä 1500.0)
   - "frequency" (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Å—Ç—Ä–æ–∫–∞: "daily" –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã—Ö, "periodic" –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö, "one_time" –¥–ª—è —Ä–∞–∑–æ–≤—ã—Ö)
   - "category" (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Å—Ç—Ä–æ–∫–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º: –ø—Ä–æ–¥—É–∫—Ç—ã, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, —Ç–∞–∫—Å–∏, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è, –∑–¥–æ—Ä–æ–≤—å–µ, –æ–¥–µ–∂–¥–∞, –¥—Ä—É–≥–∏–µ –∏–ª–∏ –Ω–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –ø–æ —Å–º—ã—Å–ª—É)
   - "description" (—Å—Ç—Ä–æ–∫–∞, –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–∞—Ö, —É—Å–ª—É–≥–∞—Ö, –∏—Å—Ç–æ—á–Ω–∏–∫–µ –¥–æ—Ö–æ–¥–∞, –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–µ –∏ —Ç.–ø., –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π "")
3. –î–∞—Ç—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ –ø–æ–ª–µ "answer":
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å - –æ—Ç–≤–µ—á–∞–π –∏—Å–ø–æ–ª—å–∑—É—è –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–ø–æ–º–∏–Ω–∞–µ—Ç —á—Ç–æ-—Ç–æ –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ - –∏—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –æ—Ç–≤–µ—Ç–∞
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ —Å–æ–æ–±—â–∞–µ—Ç –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ - –¥–∞–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

–ö–∞—Ç–µ–≥–æ—Ä–∏–∏: –ø—Ä–æ–¥—É–∫—Ç—ã, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, —Ç–∞–∫—Å–∏, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è, –∑–¥–æ—Ä–æ–≤—å–µ, –æ–¥–µ–∂–¥–∞, –¥—Ä—É–≥–∏–µ. –ú–æ–∂–µ—à—å –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –µ—Å–ª–∏ –æ–Ω–∏ –ø–æ–¥—Ö–æ–¥—è—Ç –ª—É—á—à–µ.

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ï—Å–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –µ—Å—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å—É–º–º—ã –¥–µ–Ω–µ–≥ (—Ä—É–±–ª–µ–π, —Ä—É–±–ª–µ–π, —Ä—É–±.) –∏ —á—Ç–æ –±—ã–ª–æ –∫—É–ø–ª–µ–Ω–æ/–ø—Ä–æ–¥–∞–Ω–æ/–ø–æ–ª—É—á–µ–Ω–æ/–ø–æ—Ç—Ä–∞—á–µ–Ω–æ - —ç—Ç–æ –¢–†–ê–ù–ó–ê–ö–¶–ò–Ø –∏ –µ—ë –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –Ω—É–∂–Ω–æ –∏–∑–≤–ª–µ—á—å!

–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ JSON –æ—Ç–≤–µ—Ç–∞ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è "—Å–µ–≥–æ–¥–Ω—è –∫—É–ø–∏–ª –ø—Ä–æ–¥—É–∫—Ç—ã –Ω–∞ 1500 —Ä—É–±–ª–µ–π":
{
  "transactions": [
    {
      "date": "2024-10-30",
      "time": null,
      "type": "expense",
      "amount": 1500.0,
      "frequency": "daily",
      "category": "–ø—Ä–æ–¥—É–∫—Ç—ã",
      "description": "–ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ —Å—É–º–º—É 1500 —Ä—É–±–ª–µ–π"
    }
  ],
  "answer": "–ó–∞–ø–∏—Å–∞–ª –≤–∞—à —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã –≤ —Ä–∞–∑–º–µ—Ä–µ 1500 —Ä—É–±–ª–µ–π."
}

–ü—Ä–∏–º–µ—Ä: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–Ω–µ–µ —Å–æ–æ–±—â–∏–ª "–ü–æ–µ–ª —à–∞–≤–µ—Ä–º—É –Ω–∞ 800—Ä", –∞ –ø–æ—Ç–æ–º —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç "–ß—Ç–æ—Ç–æ –µ–ª –≤–∫—É—Å–Ω–æ–µ –Ω–µ–¥–∞–≤–Ω–æ. –ß—Ç–æ —ç—Ç–æ –±—ã–ª–æ?" - –æ—Ç–≤–µ—Ç—å –∏—Å–ø–æ–ª—å–∑—É—è –∏—Å—Ç–æ—Ä–∏—é: "–í—ã –Ω–µ–¥–∞–≤–Ω–æ –µ–ª–∏ —à–∞–≤–µ—Ä–º—É –Ω–∞ 800 —Ä—É–±–ª–µ–π."

–¢–≤–æ–π –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON —Å –¥–≤—É–º—è –ø–æ–ª—è–º–∏:
- "transactions" - –º–∞—Å—Å–∏–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—É—Å—Ç–æ–π [])
- "answer" - —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ), –∏—Å–ø–æ–ª—å–∑—É–π –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

–ï—Å–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö, –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ transactions [], –Ω–æ –≤—Å–µ —Ä–∞–≤–Ω–æ –¥–∞–π –ø–æ–ª–µ–∑–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏—Å–ø–æ–ª—å–∑—É—è –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –µ—Å–ª–∏ —ç—Ç–æ —É–º–µ—Å—Ç–Ω–æ.
```

**–î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** (`prompts/system_prompt_image.txt`):
```
–¢—ã –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å–æ–≤–µ—Ç–Ω–∏–∫. –ü–æ–º–æ–≥–∞–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–µ—Å—Ç–∏ —É—á–µ—Ç –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤.

–í–ê–ñ–ù–û: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑–≤–ª–µ–∫–∞–π –¢–û–õ–¨–ö–û –∏–∑ –ø—Ä–∏—Å–ª–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—á–µ–∫–∞, —Å–∫—Ä–∏–Ω—à–æ—Ç–∞). –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞:
1. –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ (OCR)
2. –ò–∑–≤–ª–µ—á—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—á–µ–∫–∏, –≤—ã–ø–∏—Å–∫–∏, —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø–ª–∞—Ç–µ–∂–µ–π)
3. –î–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏ (–∏—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–û —ç—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º):
   - "date" (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD —Å—Ç—Ä–æ–∫–æ–π)
   - "time" (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏, —Ñ–æ—Ä–º–∞—Ç HH:MM:SS —Å—Ç—Ä–æ–∫–æ–π, –∏–Ω–∞—á–µ null)
   - "type" (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Å—Ç—Ä–æ–∫–∞: "income" –¥–ª—è –¥–æ—Ö–æ–¥–∞ –∏–ª–∏ "expense" –¥–ª—è —Ä–∞—Å—Ö–æ–¥–∞)
   - "amount" (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ float)
   - "frequency" (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Å—Ç—Ä–æ–∫–∞: "daily" –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã—Ö, "periodic" –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö, "one_time" –¥–ª—è —Ä–∞–∑–æ–≤—ã—Ö)
   - "category" (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Å—Ç—Ä–æ–∫–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º: –ø—Ä–æ–¥—É–∫—Ç—ã, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, —Ç–∞–∫—Å–∏, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è, –∑–¥–æ—Ä–æ–≤—å–µ, –æ–¥–µ–∂–¥–∞, –¥—Ä—É–≥–∏–µ –∏–ª–∏ –Ω–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –ø–æ —Å–º—ã—Å–ª—É)
   - "description" (—Å—Ç—Ä–æ–∫–∞, –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–∞—Ö, —É—Å–ª—É–≥–∞—Ö, –∏—Å—Ç–æ—á–Ω–∏–∫–µ –¥–æ—Ö–æ–¥–∞, –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–µ –∏ —Ç.–ø., –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π "")
4. –î–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö –≤ –ø–æ–ª–µ "answer"

–ö–∞—Ç–µ–≥–æ—Ä–∏–∏: –ø—Ä–æ–¥—É–∫—Ç—ã, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, —Ç–∞–∫—Å–∏, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è, –∑–¥–æ—Ä–æ–≤—å–µ, –æ–¥–µ–∂–¥–∞, –¥—Ä—É–≥–∏–µ. –ú–æ–∂–µ—à—å –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –µ—Å–ª–∏ –æ–Ω–∏ –ø–æ–¥—Ö–æ–¥—è—Ç –ª—É—á—à–µ.

–¢–≤–æ–π –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON —Å –¥–≤—É–º—è –ø–æ–ª—è–º–∏:
- "transactions" - –º–∞—Å—Å–∏–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—É—Å—Ç–æ–π [])
- "answer" - —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–ï—Å–ª–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö, –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ transactions [], –Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.
```

## –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`
2. –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
3. –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º
4. –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—á–∏—â–∞–µ—Ç—Å—è

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç: "–°–µ–≥–æ–¥–Ω—è –∫—É–ø–∏–ª –ø—Ä–æ–¥—É–∫—Ç—ã –Ω–∞ 1500 —Ä—É–±–ª–µ–π"
2. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ LLM —Å–æ structured output
3. LLM –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç TransactionResponse
4. –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ `transactions[chat_id]`
5. –ë–æ—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å
6. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
   - –û—Ç–≤–µ—Ç LLM –∏–∑ –ø–æ–ª—è `answer`
   - –°—Ç–∞—Ç—É—Å: "–ù–∞–π–¥–µ–Ω–æ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ 1 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è"
   - –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: "–ë–∞–ª–∞–Ω—Å: -1500 —Ä—É–±."

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "–ö—É–ø–∏–ª –ø—Ä–æ–¥—É–∫—Ç—ã –Ω–∞ –ø–æ–ª—Ç–æ—Ä—ã —Ç—ã—Å—è—á–∏ —Ä—É–±–ª–µ–π"
2. –ë–æ—Ç —Å–∫–∞—á–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ—Ñ–∞–π–ª (—Ñ–æ—Ä–º–∞—Ç OGG)
3. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: "üé§ –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É—é –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
4. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞—É–¥–∏–æ –≤ Whisper API –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
5. Whisper –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç: "–∫—É–ø–∏–ª –ø—Ä–æ–¥—É–∫—Ç—ã –Ω–∞ –ø–æ–ª—Ç–æ—Ä—ã —Ç—ã—Å—è—á–∏ —Ä—É–±–ª–µ–π"
6. –ë–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
7. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ LLM —Å–æ structured output
8. LLM –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç TransactionResponse
9. –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ `transactions[chat_id]`
10. –ë–æ—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å
11. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–≤–µ—Ç + —Å—Ç–∞—Ç—É—Å + –±–∞–ª–∞–Ω—Å

**–°—Ü–µ–Ω–∞—Ä–∏–π 4: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—á–µ–∫–∞)**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ–∫–∞
2. –ë–æ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ base64
3. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ VLM —Å–æ structured output
4. VLM —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
5. –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ `transactions[chat_id]`
6. –ë–æ—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å
7. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–≤–µ—Ç + —Å—Ç–∞—Ç—É—Å + –±–∞–ª–∞–Ω—Å

**–°—Ü–µ–Ω–∞—Ä–∏–π 5: –ó–∞–ø—Ä–æ—Å –±–∞–ª–∞–Ω—Å–∞**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/balance`
2. –ë–æ—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–∑ `transactions[chat_id]`:
   - –ë–∞–ª–∞–Ω—Å = —Å—É–º–º–∞ –¥–æ—Ö–æ–¥–æ–≤ - —Å—É–º–º–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤
   - –û–±—â–∞—è —Å—É–º–º–∞ –¥–æ—Ö–æ–¥–æ–≤
   - –û–±—â–∞—è —Å—É–º–º–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è
3. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç

**–°—Ü–µ–Ω–∞—Ä–∏–π 6: –°–±—Ä–æ—Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`
2. –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—á–∏—â–∞—é—Ç—Å—è
3. –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ë–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç, –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–µ PDF, –Ω–µ —Ñ–∞–π–ª—ã –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤)
- –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥—Ä—É–≥–∏—Ö (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å)
- –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ –≤—Å–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–µ—Ä—è—é—Ç—Å—è

## –ü–æ–¥—Ö–æ–¥ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—é

**–§–∞–π–ª .env** (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ git):
```bash
TELEGRAM_TOKEN=your_telegram_bot_token
OPENAI_API_KEY=your_openrouter_api_key
OPENAI_BASE_URL=https://openrouter.ai/api/v1
MODEL_TEXT=openai/gpt-oss-20b:free
MODEL_IMAGE=meta-llama/llama-3.2-11b-vision-instruct
SYSTEM_PROMPT_TEXT_PATH=prompts/system_prompt_text.txt
SYSTEM_PROMPT_IMAGE_PATH=prompts/system_prompt_image.txt
```

**–§–∞–π–ª .env.example** (–∫–æ–º–º–∏—Ç–∏—Ç—Å—è):
```bash
TELEGRAM_TOKEN=
OPENAI_API_KEY=
OPENAI_BASE_URL=https://openrouter.ai/api/v1
MODEL_TEXT=openai/gpt-oss-20b:free
MODEL_IMAGE=meta-llama/llama-3.2-11b-vision-instruct
SYSTEM_PROMPT_TEXT_PATH=prompts/system_prompt_text.txt
SYSTEM_PROMPT_IMAGE_PATH=prompts/system_prompt_image.txt

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ: –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
# SYSTEM_PROMPT_TEXT=
# SYSTEM_PROMPT_IMAGE=
```

**config.py:**
```python
import os
from pathlib import Path
from dotenv import load_dotenv

load_dotenv()

PROJECT_ROOT = Path(__file__).parent.parent

def load_prompt(prompt_file_path: str, env_var: str = None) -> str:
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è."""
    # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é
    if env_var:
        env_value = os.getenv(env_var)
        if env_value:
            return env_value
    
    # –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ—Ç, –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ —Ñ–∞–π–ª–∞
    prompt_path = PROJECT_ROOT / prompt_file_path if not os.path.isabs(prompt_file_path) else Path(prompt_file_path)
    if prompt_path.exists():
        return prompt_path.read_text(encoding="utf-8").strip()
    
    return ""

class Config:
    TELEGRAM_TOKEN = os.getenv("TELEGRAM_TOKEN")
    OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
    OPENAI_BASE_URL = os.getenv("OPENAI_BASE_URL", "https://openrouter.ai/api/v1")
    MODEL_TEXT = os.getenv("MODEL_TEXT", os.getenv("MODEL"))  # –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    MODEL_IMAGE = os.getenv("MODEL_IMAGE")
    SYSTEM_PROMPT_TEXT = load_prompt(
        os.getenv("SYSTEM_PROMPT_TEXT_PATH", "prompts/system_prompt_text.txt"),
        "SYSTEM_PROMPT_TEXT"
    )
    SYSTEM_PROMPT_IMAGE = load_prompt(
        os.getenv("SYSTEM_PROMPT_IMAGE_PATH", "prompts/system_prompt_image.txt"),
        "SYSTEM_PROMPT_IMAGE"
    )

config = Config()
```

**–ü—Ä–∏–Ω—Ü–∏–ø –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤:**
1. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `SYSTEM_PROMPT_TEXT`/`SYSTEM_PROMPT_IMAGE` (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã –Ω–∞–ø—Ä—è–º—É—é)
2. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –§–∞–π–ª—ã –ø–æ –ø—É—Ç—è–º –∏–∑ `SYSTEM_PROMPT_TEXT_PATH`/`SYSTEM_PROMPT_IMAGE_PATH`
3. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `prompts/system_prompt_text.txt` –∏ `prompts/system_prompt_image.txt`

**–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
- –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã —Ç–æ–ª—å–∫–æ –≤ .env
- –ù–µ—Ç YAML, JSON, TOML –∫–æ–Ω—Ñ–∏–≥–æ–≤
- –ù–µ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–π (dev/prod)
- –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ (—É–ø–∞–¥–µ—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫)

## –ü–æ–¥—Ö–æ–¥ –∫ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—é

**–ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π logging Python:**
```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)
```

**–ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º:**
- –°—Ç–∞—Ä—Ç/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞
- –í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (chat_id + —Ç–µ–∫—Å—Ç)
- –û—Ç–≤–µ—Ç—ã LLM (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç–≤–µ—Ç–∞ + –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ LLM
- –ò—Å–∫–ª—é—á–µ–Ω–∏—è

**–ß—Ç–æ –ù–ï –ª–æ–≥–∏—Ä—É–µ–º:**
- –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–π—Å—ã —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ú–µ—Ç—Ä–∏–∫–∏, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

**–í—ã–≤–æ–¥:** –¢–æ–ª—å–∫–æ –≤ stdout/stderr (–∫–æ–Ω—Å–æ–ª—å)

**–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
- –ë–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ (structlog –∏ —Ç.–ø.)
- –ë–µ–∑ —Ñ–∞–π–ª–æ–≤, —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤
- –ë–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –≤–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- –ü—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç


